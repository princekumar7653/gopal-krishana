<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Welcome - Prince Kumar Portfolio</title>
    
    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="/favicon.svg">
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        'sans': ['Inter', 'system-ui', 'sans-serif'],
                    },
                    colors: {
                        primary: {
                            50: '#f0f9ff',
                            500: '#0ea5e9',
                            600: '#0284c7',
                            700: '#0369a1',
                            900: '#0c4a6e',
                        },
                        secondary: {
                            500: '#8b5cf6',
                            600: '#7c3aed',
                        },
                        accent: {
                            500: '#06b6d4',
                            600: '#0891b2',
                        }
                    }
                }
            }
        }
    </script>
    
    <style>
        .gradient-text {
            background: linear-gradient(135deg, #0ea5e9, #8b5cf6, #06b6d4);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .glass {
            background: rgba(15, 23, 42, 0.8);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .floating-shape {
            position: absolute;
            border-radius: 50%;
            opacity: 0.1;
            animation: float 6s ease-in-out infinite;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            33% { transform: translateY(-20px) rotate(120deg); }
            66% { transform: translateY(10px) rotate(240deg); }
        }
        
        .btn-ripple {
            position: relative;
            overflow: hidden;
        }
        
        .btn-ripple::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            transition: width 0.6s, height 0.6s;
            transform: translate(-50%, -50%);
            z-index: 0;
        }
        
        .btn-ripple:hover::before {
            width: 300px;
            height: 300px;
        }
        
        .btn-ripple > * {
            position: relative;
            z-index: 1;
        }
        
        .form-container {
            opacity: 0;
            transform: translateY(50px);
        }
        
        .form-container.animate {
            opacity: 1;
            transform: translateY(0);
            transition: all 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }
    </style>
</head>

<body class="bg-slate-900 text-slate-100 font-sans min-h-screen flex items-center justify-center overflow-hidden">
    <!-- Animated Background -->
    <div class="absolute inset-0 overflow-hidden">
        <div class="floating-shape w-64 h-64 bg-gradient-to-r from-primary-500 to-accent-500 top-10 left-10" style="animation-delay: 0s;"></div>
        <div class="floating-shape w-48 h-48 bg-gradient-to-r from-secondary-500 to-primary-500 top-1/3 right-20" style="animation-delay: 2s;"></div>
        <div class="floating-shape w-32 h-32 bg-gradient-to-r from-accent-500 to-secondary-500 bottom-20 left-1/4" style="animation-delay: 4s;"></div>
        <div class="floating-shape w-40 h-40 bg-gradient-to-r from-primary-500 to-secondary-500 bottom-32 right-1/3" style="animation-delay: 1s;"></div>
    </div>
    
    <!-- Main Content -->
    <div class="relative z-10 w-full max-w-md mx-auto px-6">
        <div class="form-container glass rounded-2xl p-8 shadow-2xl">
            <!-- Header -->
            <div class="text-center mb-8">
                <div class="w-16 h-16 bg-gradient-to-r from-primary-500 to-accent-500 rounded-full flex items-center justify-center mx-auto mb-4">
                    <span class="text-white font-bold text-2xl">P</span>
                </div>
                <h1 class="text-3xl font-bold gradient-text mb-2">Welcome!</h1>
                <p class="text-slate-400">Please enter your name to explore my portfolio</p>
            </div>
            
            <!-- Entry Form -->
            <form id="visitorForm" class="space-y-6" onsubmit="return false;">
                <div>
                    <label for="visitorName" class="block text-sm font-medium text-slate-300 mb-2">
                        Your Name *
                    </label>
                    <input 
                        type="text" 
                        id="visitorName" 
                        name="visitorName" 
                        required
                        class="w-full px-4 py-3 bg-slate-800 border border-slate-600 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent text-white placeholder-slate-400 transition-all duration-300"
                        placeholder="Enter your full name"
                        autocomplete="name"
                    >
                </div>
                
                <div>
                    <label for="visitorEmail" class="block text-sm font-medium text-slate-300 mb-2">
                        Email (Optional)
                    </label>
                    <input 
                        type="email" 
                        id="visitorEmail" 
                        name="visitorEmail"
                        class="w-full px-4 py-3 bg-slate-800 border border-slate-600 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent text-white placeholder-slate-400 transition-all duration-300"
                        placeholder="your.email@example.com"
                        autocomplete="email"
                    >
                </div>
                
                <div>
                    <label for="visitPurpose" class="block text-sm font-medium text-slate-300 mb-2">
                        Purpose of Visit (Optional)
                    </label>
                    <select 
                        id="visitPurpose" 
                        name="visitPurpose"
                        class="w-full px-4 py-3 bg-slate-800 border border-slate-600 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent text-white transition-all duration-300"
                    >
                        <option value="">Select purpose</option>
                        <option value="hiring">Looking to hire</option>
                        <option value="collaboration">Collaboration opportunity</option>
                        <option value="inspiration">Seeking inspiration</option>
                        <option value="networking">Networking</option>
                        <option value="other">Other</option>
                    </select>
                </div>
                
                <button 
                    type="button" 
                    id="submitBtn"
                    class="w-full btn-ripple bg-gradient-to-r from-primary-500 to-accent-500 hover:from-primary-600 hover:to-accent-600 text-white font-medium py-3 px-6 rounded-lg transition-all duration-300 hover:shadow-lg hover:shadow-primary-500/25 disabled:opacity-50 disabled:cursor-not-allowed"
                >
                    <span class="flex items-center justify-center gap-2">
                        <span id="btnText">Enter Portfolio</span>
                        <svg id="btnIcon" class="w-5 h-5 transition-transform group-hover:translate-x-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3"></path>
                        </svg>
                        <div id="btnSpinner" class="hidden w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"></div>
                    </span>
                </button>
            </form>
            
            <!-- Footer -->
            <div class="text-center mt-6 pt-6 border-t border-slate-700">
                <p class="text-xs text-slate-500 mb-3">
                    Your information helps me understand my visitors better
                </p>
                <button onclick="window.location.href='./portfolio'" class="text-xs text-slate-400 hover:text-slate-300 underline transition-colors duration-300">
                    Skip and go directly to portfolio â†’
                </button>
            </div>
        </div>
    </div>
    
    <!-- Success Message -->
    <div id="successMessage" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="glass rounded-2xl p-8 max-w-sm mx-4 text-center">
            <div class="w-16 h-16 bg-green-500 rounded-full flex items-center justify-center mx-auto mb-4">
                <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                </svg>
            </div>
            <h3 class="text-xl font-bold text-white mb-2">Welcome!</h3>
            <p class="text-slate-300 mb-4">Redirecting to portfolio...</p>
            <div class="w-8 h-8 border-2 border-primary-500 border-t-transparent rounded-full animate-spin mx-auto"></div>
        </div>
    </div>

    <script>
        class VisitorEntry {
            constructor() {
                this.form = document.getElementById('visitorForm');
                this.submitBtn = document.getElementById('submitBtn');
                this.btnText = document.getElementById('btnText');
                this.btnIcon = document.getElementById('btnIcon');
                this.btnSpinner = document.getElementById('btnSpinner');
                this.successMessage = document.getElementById('successMessage');

                this.init();
            }

            init() {
                this.setupEventListeners();
                this.animateForm();
                this.setupFormValidation();
            }

            setupEventListeners() {
                this.submitBtn.addEventListener('click', (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    this.handleSubmit(e);
                });

                this.form.addEventListener('submit', (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    return false;
                });
            }

            animateForm() {
                setTimeout(() => {
                    document.querySelector('.form-container').classList.add('animate');
                }, 300);
            }

            setupFormValidation() {
                const nameInput = document.getElementById('visitorName');
                const emailInput = document.getElementById('visitorEmail');

                nameInput.addEventListener('input', () => {
                    this.validateName(nameInput.value);
                });

                emailInput.addEventListener('input', () => {
                    if (emailInput.value) {
                        this.validateEmail(emailInput.value);
                    }
                });
            }

            validateName(name) {
                const nameInput = document.getElementById('visitorName');
                const isValid = name.trim().length >= 2;

                if (isValid) {
                    nameInput.classList.remove('border-red-500');
                    nameInput.classList.add('border-green-500');
                } else {
                    nameInput.classList.remove('border-green-500');
                    nameInput.classList.add('border-red-500');
                }

                return isValid;
            }

            validateEmail(email) {
                const emailInput = document.getElementById('visitorEmail');
                const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                const isValid = emailRegex.test(email);

                if (isValid) {
                    emailInput.classList.remove('border-red-500');
                    emailInput.classList.add('border-green-500');
                } else {
                    emailInput.classList.remove('border-green-500');
                    emailInput.classList.add('border-red-500');
                }

                return isValid;
            }

            async handleSubmit(e) {
                if (e) {
                    e.preventDefault();
                    e.stopPropagation();
                }

                console.log('ðŸš€ Button clicked - processing visitor entry');

                const visitorData = {
                    name: document.getElementById('visitorName').value.trim(),
                    email: document.getElementById('visitorEmail').value.trim(),
                    purpose: document.getElementById('visitPurpose').value,
                    timestamp: new Date().toISOString(),
                    userAgent: navigator.userAgent,
                    referrer: document.referrer,
                    language: navigator.language,
                    timezone: Intl.DateTimeFormat().resolvedOptions().timeZone
                };

                console.log('ðŸ“ Processing visitor:', visitorData.name);

                if (!this.validateName(visitorData.name)) {
                    this.showError('Please enter a valid name (at least 2 characters)');
                    return;
                }

                if (visitorData.email && !this.validateEmail(visitorData.email)) {
                    this.showError('Please enter a valid email address');
                    return;
                }

                this.setLoadingState(true);

                setTimeout(async () => {
                    try {
                        this.storeVisitorData(visitorData);
                        console.log('ðŸ’¾ Data stored locally');

                        await this.sendEmailNotification(visitorData);
                        console.log('ðŸ“§ Email sent');

                        console.log('ðŸŽ‰ Showing success message...');
                        this.showSuccess(visitorData.name);

                    } catch (error) {
                        console.log('âŒ Error:', error);
                        this.showError('Something went wrong. Please try again.');
                        this.setLoadingState(false);
                    }
                }, 50);
            }

            storeVisitorData(visitorData) {
                const visitors = JSON.parse(localStorage.getItem('portfolioVisitors') || '[]');
                visitors.push(visitorData);

                if (visitors.length > 100) {
                    visitors.splice(0, visitors.length - 100);
                }

                localStorage.setItem('portfolioVisitors', JSON.stringify(visitors));
                sessionStorage.setItem('currentVisitor', JSON.stringify(visitorData));
            }

            async sendEmailNotification(visitorData) {
                const backendUrl = 'http://localhost:3003';

                try {
                    const response = await fetch(`${backendUrl}/api/visitor`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(visitorData)
                    });

                    if (!response.ok) {
                        throw new Error('Failed to send notification');
                    }

                    return await response.json();
                } catch (error) {
                    console.warn('Email notification failed:', error);
                    return {
                        success: true,
                        method: 'local_only',
                        message: 'Visitor logged locally'
                    };
                }
            }

            setLoadingState(loading) {
                if (loading) {
                    this.submitBtn.disabled = true;
                    this.btnText.textContent = 'Processing...';
                    this.btnIcon.classList.add('hidden');
                    this.btnSpinner.classList.remove('hidden');
                } else {
                    this.submitBtn.disabled = false;
                    this.btnText.textContent = 'Enter Portfolio';
                    this.btnIcon.classList.remove('hidden');
                    this.btnSpinner.classList.add('hidden');
                }
            }

            showSuccess(name) {
                console.log('âœ… SUCCESS - Showing success message for:', name);

                if (this.successMessage) {
                    this.successMessage.classList.remove('hidden');
                    console.log('âœ… Success message displayed');
                }

                console.log('â° Setting redirect timer for 2 seconds...');
                setTimeout(() => {
                    console.log('ðŸ”„ Redirecting to portfolio...');
                    window.location.href = './portfolio';
                }, 2000);
            }

            showError(message) {
                const existingError = document.querySelector('.error-message');
                if (existingError) {
                    existingError.remove();
                }

                const errorDiv = document.createElement('div');
                errorDiv.className = 'error-message bg-red-500/20 border border-red-500/30 rounded-lg p-3 mt-4 text-red-400 text-sm';
                errorDiv.textContent = message;

                this.form.appendChild(errorDiv);

                setTimeout(() => {
                    errorDiv.remove();
                }, 5000);
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            new VisitorEntry();
        });
    </script>
</body>
</html>